<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<style>
		canvas {
			box-shadow: 0 0 10px #8888;
			height: 500px;
			width: 500px;
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%)
		}
	</style>
</head>

<body>
	<canvas></canvas>
</body>
<script type="module">
	function getTextRgbaData(text, precision) {
		if (!getTextRgbaData.ctx) {
			const canvas = document.createElement("canvas");
			canvas.style.height = precision + "px";
			canvas.style.width = precision + "px";
			canvas.style.display = "none";
			canvas.height = precision;
			canvas.width = precision;
			document.documentElement.appendChild(canvas);

			getTextRgbaData.ctx = canvas.getContext("2d");
			getTextRgbaData.ctx.textAlign = "center";
			getTextRgbaData.ctx.font = precision * 0.9 + "px Arial";
			getTextRgbaData.ctx.textBaseline = "middle";
		}

		const ctx = getTextRgbaData.ctx;
		ctx.fillText(text, precision / 2, precision / 2);

		const imageData = ctx.getImageData(0, 0, precision, precision).data;
		return imageData.reduce((rgbaData, d, index) => {
			const i = Math.floor(index / 4);
			const x = i % precision;
			const y = Math.floor(i / precision);
			if (!rgbaData[x]) {
				rgbaData[x] = [];
			}
			if (!rgbaData[x][y]) {
				rgbaData[x][y] = {};
			}
			rgbaData[x][y]["rgba"[index % 4]] = d;
			return rgbaData;
		}, []);
	}

	function runTextAnimation(ctx, itemSize, rgbaDatas, step = 0, frameNumber = 0) {
		if (!rgbaDatas[step]) step = 0;
		const rgbaData = rgbaDatas[step];
		rgbaData.forEach((rowRgba, x) => {
			rowRgba.forEach(({
				r,
				g,
				b,
				a
			}, y) => {
				const px = (x * 2 + 1) * itemSize * 0.6;
				const py = (y * 2 + 1) * itemSize * 0.6;
				ctx.beginPath();
				ctx.arc(px, py, itemSize / 2, 0, 2 * Math.PI);
				ctx.fillStyle = `rgba(${r},${g},${b},${a})`;
				const gra = ctx.createRadialGradient(px + itemSize / 4, py + itemSize / 4, itemSize / 2, px - itemSize / 4, py - itemSize / 4, itemSize / 2);
				gra.addColorStop(0, `rgba(${r / 5},${g / 5},${b / 5},${a})`);
				gra.addColorStop(0.2, `rgba(${r * 2 / 5},${g * 2 / 5},${b * 2 / 5},${a})`);
				gra.addColorStop(1, `rgba(${r},${g},${b},${a})`);
				ctx.fillStyle = gra;
				ctx.fill();
			})
		})
	}

	function init({
		string,
		precision,
		itemSize
	}) {
		const rgbaDatas = [];
		for (const letter of string) {
			rgbaDatas.push(getTextRgbaData(letter, precision));
		}
		const canvas = document.querySelector("canvas");
		canvas.width = precision * itemSize * 1.2;
		canvas.height = precision * itemSize * 1.2;
		const ctx = canvas.getContext("2d");
		runTextAnimation(ctx, itemSize, rgbaDatas);
	}

	init({
		string: "ðŸšš",
		precision: 20,
		itemSize: 50
	});
</script>

</html>
