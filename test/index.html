<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <input type="file" id="fileInput">
</body>

<script>
    // 1. File 转换为 Blob
    function fileToBlob(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = () => resolve(new Blob([reader.result]));
            reader.readAsArrayBuffer(file);
        });
    }

    // 2. Blob 转换为 ArrayBuffer
    function blobToArrayBuffer(blob) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.readAsArrayBuffer(blob);
        });
    }

    // 3. ArrayBuffer 转换为 base64
    function arrayBufferToBase64(arrayBuffer) {
        const uint8Array = new Uint8Array(arrayBuffer);
        return btoa(String.fromCharCode.apply(null, uint8Array));
    }

    // 4. base64 转换为 ArrayBuffer
    function base64ToArrayBuffer(base64) {
        const binaryString = atob(base64);
        const length = binaryString.length;
        const uint8Array = new Uint8Array(length);

        for (let i = 0; i < length; i++) {
            uint8Array[i] = binaryString.charCodeAt(i);
        }

        return uint8Array.buffer;
    }

    // 5. Blob 转换为 Data URL
    function blobToDataURL(blob) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(blob);
        });
    }

    // 示例
    const input = document.getElementById('fileInput');

    input.addEventListener('change', async (event) => {
        const file = event.target.files[0];

        // File 转换为 Blob
        const blob = await fileToBlob(file);

        // Blob 转换为 ArrayBuffer
        const arrayBuffer = await blobToArrayBuffer(blob);

        // ArrayBuffer 转换为 base64
        const base64 = arrayBufferToBase64(arrayBuffer);

        // base64 转换为 ArrayBuffer
        const newArrayBuffer = base64ToArrayBuffer(base64);

        // Blob 转换为 Data URL
        const dataURL = await blobToDataURL(blob);

        console.log({
            file,
            blob,
            arrayBuffer,
            base64,
            newArrayBuffer,
            dataURL,
        });
    });

</script>

</html>
